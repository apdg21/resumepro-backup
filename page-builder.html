<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Webpage Builder</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            min-height: 100vh;
            line-height: 1.6;
        }

        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .sidebar {
            background-color: #ffffff;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            overflow-y: auto;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .sidebar h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }

        .preview-area {
            background-color: #f3f4f6;
            padding: 1.5rem;
            min-height: 100vh;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center the preview container */
        }

        .preview-container {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 1200px;
        }

        .section-preview {
            transition: all 0.3s ease;
            border-radius: 0.5rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            min-height: 100px;
            width: 100%; /* Ensure full width */
        }

        .selected-section {
            border: 2px solid #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
            border-radius: 0.5rem;
        }

        button {
            transition: all 0.2s ease;
            font-weight: 500;
            min-height: 44px;
            padding: 0.6rem 1rem;
        }

        button:hover {
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        input, select, textarea {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.6rem;
            width: 100%;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            min-height: 44px;
            cursor: text;
            resize: vertical;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .item-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .item-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .mobile-preview {
            width: 375px;
            margin: 0 auto;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background: #f3f4f6;
            color: #4b5563;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-button.active {
            background: #3b82f6;
            color: white;
        }

        .link-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .column-layout {
            display: grid;
            gap: 1rem;
        }

        .draggable-item {
            padding: 1rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s;
        }

        .draggable-item:hover {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .drop-zone.active {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }

        .column {
            position: relative;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background: #f9fafb;
            min-height: 100px;
        }

        .column-resize-handle {
            position: absolute;
            top: 0;
            right: -5px;
            width: 10px;
            height: 100%;
            cursor: col-resize;
            background: transparent;
            z-index: 10;
        }

        .column-resize-handle:hover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 4px;
            width: 2px;
            height: 100%;
            background: #3b82f6;
        }

        .column-content {
            min-height: 50px;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
            justify-content: center; /* Center content vertically */
            width: 100%;
        }

        .element {
            padding: 0.75rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            cursor: move;
            width: 100%; /* Ensure elements take full width of column */
        }

        .element:hover {
            border-color: #3b82f6;
        }

        .grid-layout {
            display: grid;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .width-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .width-slider {
            flex: 1;
        }

        .width-input {
            width: 60px;
        }

        .style-control-group {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .style-control-group h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
        }

        .range-value {
            min-width: 40px;
            text-align: right;
            font-size: 0.875rem;
        }

        .section-header {
            display: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .sidebar-toggle {
            display: none;
            padding: 0.5rem 1rem;
            background: #3b82f6;
            color: white;
            border-radius: 0.375rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .input-with-unit {
            display: flex;
            align-items: center;
        }
        
        .input-with-unit input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }
        
        .input-with-unit .unit {
            background: #f3f4f6;
            padding: 0 0.75rem;
            height: 44px;
            display: flex;
            align-items: center;
            border-top-right-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            border: 1px solid #d1d5db;
            border-left: none;
        }

        .gradient-preview {
            width: 100%;
            height: 60px;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            margin-bottom: 0.5rem;
        }

        .alignment-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .alignment-btn {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alignment-btn.active {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }

        .alignment-btn i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .custom-css-editor, .custom-js-editor {
            font-family: monospace;
            min-height: 120px;
        }

        .element-button {
            background-color: #3b82f6 !important;
            color: white !important;
        }

        .element-button:hover {
            background-color: #2563eb !important;
        }

        @media (max-width: 768px) {
            .flex {
                flex-direction: column;
            }

            .sidebar {
                display: none;
                height: auto;
                position: static;
                padding: 1rem;
            }

            .sidebar.active {
                display: block;
            }

            .sidebar-toggle {
                display: block;
            }

            .preview-container {
                padding: 1rem;
                max-width: 100%;
            }

            .grid-layout {
                grid-template-columns: 1fr !important;
            }

            button, input, select, textarea {
                font-size: 1rem;
                min-height: 44px;
            }
        }

        @media (max-width: 480px) {
            .preview-container {
                padding: 0.5rem;
            }

            .properties-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // Section types with categories
        const sectionCategories = {
            "Layout": ["1 Column", "2 Columns", "3 Columns"],
            "Content": ["Text", "Image", "Button", "Heading", "Paragraph"],
            "Elements": ["Card", "Form", "Divider", "Custom HTML"]
        };

        // Font options
        const fontOptions = [
            "Inter, sans-serif",
            "Arial, sans-serif",
            "Helvetica, sans-serif",
            "Georgia, serif",
            "Times New Roman, serif",
            "Courier New, monospace",
            "Verdana, sans-serif",
            "Impact, sans-serif"
        ];

        // Element types with safe default styles
        const elementTypes = {
            "Text": { 
                icon: "fa-font", 
                defaultContent: "This is a text element. You can edit me!",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#000000",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "normal",
                    textAlign: "center",
                    lineHeight: "1.5",
                    padding: "0px",
                    margin: "0px",
                    backgroundColor: "transparent",
                    border: "none",
                    borderRadius: "0px",
                    width: "auto",
                    height: "auto",
                    className: "text-element"
                }
            },
            "Image": {
                icon: "fa-image",
                defaultContent: "https://via.placeholder.com/800x600",
                defaultStyles: {
                    width: "100%",
                    maxWidth: "1200px",
                    height: "auto",
                    padding: "0px",
                    margin: "0px auto",
                    border: "none",
                    borderRadius: "0px",
                    display: "block",
                    objectFit: "contain",
                    className: "image-element"
                }
            },
            "Button": { 
                icon: "fa-square", 
                defaultContent: "Click Me",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#ffffff",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "bold",
                    padding: "10px 20px",
                    margin: "0px auto",
                    backgroundColor: "#3b82f6",
                    border: "none",
                    borderRadius: "6px",
                    textAlign: "center",
                    width: "auto",
                    height: "auto",
                    display: "block",
                    className: "button-element"
                }
            },
            "Heading": { 
                icon: "fa-heading", 
                defaultContent: "This is a Heading",
                defaultStyles: {
                    fontSize: "24px",
                    color: "#000000",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "bold",
                    textAlign: "center",
                    lineHeight: "1.2",
                    padding: "0px",
                    margin: "0px 0px 16px 0px",
                    backgroundColor: "transparent",
                    border: "none",
                    borderRadius: "0px",
                    width: "auto",
                    height: "auto",
                    className: "heading-element"
                }
            },
            "Paragraph": { 
                icon: "fa-paragraph", 
                defaultContent: "This is a paragraph of text. You can replace it with your own content.",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#333333",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "normal",
                    textAlign: "center",
                    lineHeight: "1.6",
                    padding: "0px",
                    margin: "0px 0px 16px 0px",
                    backgroundColor: "transparent",
                    border: "none",
                    borderRadius: "0px",
                    width: "auto",
                    height: "auto",
                    className: "paragraph-element"
                }
            },
            "Card": { 
                icon: "fa-id-card", 
                defaultContent: "Card Title\nCard content goes here.",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#000000",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "normal",
                    textAlign: "center",
                    lineHeight: "1.5",
                    padding: "20px",
                    margin: "0px auto",
                    backgroundColor: "#ffffff",
                    border: "1px solid #e5e7eb",
                    borderRadius: "8px",
                    boxShadow: "0 2px 4px rgba(0,0,0,0.1)",
                    width: "auto",
                    height: "auto",
                    className: "card-element"
                }
            },
            "Form": {
                icon: "fa-window-restore",
                defaultContent: "Name:\nEmail:\nMessage:",
                defaultStyles: {
                    padding: "20px",
                    margin: "0px auto",
                    backgroundColor: "#f9fafb",
                    border: "1px solid #e5e7eb",
                    borderRadius: "8px",
                    width: "auto",
                    height: "auto",
                    color: "#000000",
                    className: "form-element"
                }
            },
            "Divider": {
                icon: "fa-minus",
                defaultContent: "",
                defaultStyles: {
                    height: "1px",
                    backgroundColor: "#e5e7eb",
                    margin: "20px auto",
                    border: "none",
                    width: "80%",
                    className: "divider-element"
                }
            },
            "Custom HTML": {
                icon: "fa-code",
                defaultContent: "<div class='custom-content'>\n  <h3>Custom HTML</h3>\n  <p>You can add any HTML content here</p>\n</div>",
                defaultStyles: {
                    padding: "20px",
                    margin: "0px auto",
                    backgroundColor: "#f0f9ff",
                    border: "1px dashed #3b82f6",
                    borderRadius: "8px",
                    width: "auto",
                    height: "auto",
                    className: "custom-html-element"
                }
            }
        };

        // Templates for different section types with safe defaults
        const templates = {
            "1 Column": {
                columns: 1,
                widths: [100],
                elements: [],
                columnAlignments: ["center"],
                styles: {
                    display: "flex",
                    flexDirection: "row",
                    justifyContent: "center",
                    gap: "16px",
                    backgroundColor: "transparent",
                    padding: "16px",
                    color: "#000000",
                    className: "section-1col"
                }
            },
            "2 Columns": {
                columns: 2,
                widths: [50, 50],
                elements: [],
                columnAlignments: ["center", "center"],
                styles: {
                    display: "flex",
                    flexDirection: "row",
                    justifyContent: "center",
                    gap: "16px",
                    backgroundColor: "transparent",
                    padding: "16px",
                    color: "#000000",
                    className: "section-2col"
                }
            },
            "3 Columns": {
                columns: 3,
                widths: [33.33, 33.33, 33.33],
                elements: [],
                columnAlignments: ["center", "center", "center"],
                styles: {
                    display: "flex",
                    flexDirection: "row",
                    justifyContent: "center",
                    gap: "16px",
                    backgroundColor: "transparent",
                    padding: "16px",
                    color: "#000000",
                    className: "section-3col"
                }
            }
        };

        // State management
        let sections = [];
        let selectedSection = null;
        let selectedColumn = null;
        let selectedElement = null;
        let isMobileView = false;
        let activeTab = 'content';
        let draggedElement = null;
        let selectedCategory = 'Layout';
        let htmlExport = '';
        let showExportModal = false;
        let showImportModal = false;
        let importHtml = '';
        let isSidebarOpen = false;
        let globalCSS = '';
        let globalJS = '';

        // Remember scroll position
        let lastScrollPosition = 0;

        // Validate style value
        function isValidStyleValue(property, value) {
            if (!value || value.trim() === '') return false;
            
            // Special handling for background gradients
            if (property === 'backgroundImage') {
                return value === 'none' || value.includes('gradient') || value.includes('url');
            }
            
            if (['fontSize', 'lineHeight', 'width', 'maxWidth', 'height', 'borderRadius'].includes(property)) {
                if (property === 'lineHeight') {
                    return !isNaN(parseFloat(value)) || value === 'normal';
                }
                return /^[0-9]+(px|%|rem|em|vw|vh)?$/.test(value);
            }
            if (['color', 'backgroundColor'].includes(property)) {
                return /^#[0-9A-Fa-f]{6}$|^#[0-9A-Fa-f]{3}$|^transparent$|^[a-zA-Z]+$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/.test(value);
            }
            if (['padding', 'margin', 'border'].includes(property)) {
                return /^[0-9]+(px|%|rem|em)?(\s[0-9]+(px|%|rem|em)?)*$|^none$|^auto$/.test(value);
            }
            return true;
        }

        // Add a new section
        function addSection(type) {
            if (!type) return;
            
            let newSection;
            
            if (templates[type]) {
                newSection = {
                    id: Date.now(),
                    type,
                    columns: templates[type].columns,
                    widths: [...templates[type].widths],
                    elements: Array(templates[type].columns).fill().map(() => []),
                    columnAlignments: [...templates[type].columnAlignments],
                    styles: { ...templates[type].styles }
                };
            } else {
                newSection = {
                    id: Date.now(),
                    type,
                    columns: 1,
                    widths: [100],
                    elements: [[]],
                    columnAlignments: ["center"],
                    styles: {
                        display: "flex",
                        flexDirection: "row",
                        justifyContent: "center",
                        gap: "16px",
                        backgroundColor: "transparent",
                        padding: "16px",
                        color: "#000000",
                        className: `section-${type.toLowerCase().replace(/\s+/g, '-')}`
                    }
                };
            }
            
            sections = [...sections, newSection];
            selectedSection = newSection;
            selectedColumn = null;
            selectedElement = null;
            renderApp();
        }

        // Remove a section
        function removeSection(sectionId) {
            sections = sections.filter(section => section.id !== sectionId);
            if (selectedSection && selectedSection.id === sectionId) {
                selectedSection = null;
                selectedColumn = null;
                selectedElement = null;
            }
            renderApp();
        }

        // Add a column to a section
        function addColumn(sectionId) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newWidth = 100 / (section.columns + 1);
                    const newWidths = section.widths.map(width => width * (section.columns / (section.columns + 1)));
                    newWidths.push(newWidth);
                    
                    return {
                        ...section,
                        columns: section.columns + 1,
                        widths: newWidths,
                        elements: [...section.elements, []],
                        columnAlignments: [...section.columnAlignments, "center"]
                    };
                }
                return section;
            });
            renderApp();
        }

        // Remove a column from a section
        function removeColumn(sectionId, columnIndex) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    if (section.columns <= 1) return section;
                    
                    const removedWidth = section.widths[columnIndex];
                    const newWidths = section.widths.filter((_, i) => i !== columnIndex);
                    const widthRatio = 100 / (100 - removedWidth);
                    const adjustedWidths = newWidths.map(width => width * widthRatio);
                    
                    return {
                        ...section,
                        columns: section.columns - 1,
                        widths: adjustedWidths,
                        elements: section.elements.filter((_, i) => i !== columnIndex),
                        columnAlignments: section.columnAlignments.filter((_, i) => i !== columnIndex)
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update column width
        function updateColumnWidth(sectionId, columnIndex, newWidth) {
            if (isNaN(newWidth) || newWidth < 10 || newWidth > 90) return;
            
            // Smoothly update the width
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const oldWidth = section.widths[columnIndex];
                    const widthDiff = newWidth - oldWidth;
                    const remainingColumns = section.columns - 1;
                    
                    const adjustmentPerColumn = -widthDiff / remainingColumns;
                    
                    const newWidths = section.widths.map((width, i) => {
                        if (i === columnIndex) return newWidth;
                        return Math.max(10, Math.min(90, width + adjustmentPerColumn));
                    });
                    
                    // Normalize to ensure total is 100%
                    const total = newWidths.reduce((sum, width) => sum + width, 0);
                    const normalizedWidths = newWidths.map(width => (width / total) * 100);
                    
                    return {
                        ...section,
                        widths: normalizedWidths
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update column alignment
        function updateColumnAlignment(sectionId, columnIndex, alignment) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newAlignments = [...section.columnAlignments];
                    newAlignments[columnIndex] = alignment;
                    
                    return {
                        ...section,
                        columnAlignments: newAlignments
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update section layout style
        function updateSectionStyle(sectionId, styleProperty, value) {
            if (!isValidStyleValue(styleProperty, value)) return;
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    return {
                        ...section,
                        styles: {
                            ...section.styles,
                            [styleProperty]: value
                        }
                    };
                }
                return section;
            });
            renderApp();
        }

        // Handle drag start for elements
        function handleDragStart(e, elementType) {
            draggedElement = elementType;
            e.dataTransfer.setData('text/plain', elementType);
            e.dataTransfer.effectAllowed = 'move';
        }

        // Handle drag over for drop zones
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('active');
        }

        // Handle drag leave for drop zones
        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('active');
        }

        // Handle drop for adding elements
        function handleDrop(e, sectionId, columnIndex) {
            e.preventDefault();
            e.currentTarget.classList.remove('active');
            
            const elementType = e.dataTransfer.getData('text/plain');
            if (!elementType) return;
            
            const newElement = {
                id: Date.now(),
                type: elementType,
                content: elementTypes[elementType].defaultContent,
                styles: {...elementTypes[elementType].defaultStyles},
                className: `${elementType.toLowerCase().replace(/\s+/g, '-')}-${Date.now()}`
            };
            
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = [...section.elements];
                    newElements[columnIndex] = [...newElements[columnIndex], newElement];
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            
            // Select the new element
            selectedElement = newElement;
            selectedColumn = columnIndex;
            selectedSection = sections.find(s => s.id === sectionId);
            
            renderApp();
        }

        // Handle element content update
        function updateElementContent(sectionId, columnIndex, elementId, newContent) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        content: newContent || elementTypes[element.type].defaultContent
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Handle element style update
        function updateElementStyle(sectionId, columnIndex, elementId, styleProperty, value) {
            if (!isValidStyleValue(styleProperty, value)) return;
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        styles: {
                                            ...element.styles,
                                            [styleProperty]: value
                                        }
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update element class name
        function updateElementClassName(sectionId, columnIndex, elementId, className) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        className: className
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Remove an element
        function removeElement(sectionId, columnIndex, elementId) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.filter(element => element.id !== elementId);
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            
            if (selectedElement && selectedElement.id === elementId) {
                selectedElement = null;
            }
            renderApp();
        }

        // Generate HTML from the current layout
        function generateHTML() {
            let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Webpage</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -15px;
            justify-content: center;
        }
        .column {
            padding: 0 15px;
            box-sizing: border-box;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Global CSS */
        ${globalCSS}
        
        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }
            .column {
                width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">\n`;

            sections.forEach(section => {
                const styleString = Object.entries(section.styles || {}).map(([key, value]) => {
                    if (key === 'className') return '';
                    const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                    return `${cssKey}: ${value};`;
                }).join(' ');
                
                html += `        <div class="section ${section.styles.className || ''}" style="${styleString}">\n`;
                html += `            <div class="row">\n`;
                
                section.elements.forEach((column, colIndex) => {
                    const width = section.widths[colIndex];
                    const alignment = section.columnAlignments[colIndex] || "center";
                    
                    // Convert alignment to CSS text-align
                    let textAlign = "center";
                    if (alignment === "flex-start") textAlign = "left";
                    if (alignment === "flex-end") textAlign = "right";
                    
                    html += `                <div class="column" style="width: ${width}%; text-align: ${textAlign}">\n`;
                    
                    column.forEach(element => {
                        const elementStyleString = Object.entries(element.styles || {}).map(([key, value]) => {
                            if (key === 'className') return '';
                            const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                            return `${cssKey}: ${value};`;
                        }).join(' ');
                        
                        switch (element.type) {
                            case "Text":
                                html += `                    <div class="${element.className}" style="${elementStyleString}">${element.content}</div>\n`;
                                break;
                            case "Image":
                                html += `                    <img src="${element.content}" alt="Image" class="${element.className}" style="${elementStyleString}">\n`;
                                break;
                            case "Button":
                                html += `                    <a href="#" class="btn ${element.className}" style="${elementStyleString}">${element.content}</a>\n`;
                                break;
                            case "Heading":
                                html += `                    <h2 class="${element.className}" style="${elementStyleString}">${element.content}</h2>\n`;
                                break;
                            case "Paragraph":
                                html += `                    <p class="${element.className}" style="${elementStyleString}">${element.content}</p>\n`;
                                break;
                            case "Card":
                                const cardContent = element.content.split('\n');
                                html += `                    <div class="card ${element.className}" style="${elementStyleString}">\n`;
                                if (cardContent[0]) html += `                        <h3>${cardContent[0]}</h3>\n`;
                                if (cardContent[1]) html += `                        <p>${cardContent[1]}</p>\n`;
                                html += `                    </div>\n`;
                                break;
                            case "Form":
                                const formContent = element.content.split('\n');
                                html += `                    <form class="${element.className}" style="${elementStyleString}">\n`;
                                formContent.forEach(field => {
                                    if (field.trim()) {
                                        const fieldName = field.replace(':', '');
                                        html += `                        <label>${fieldName}</label>\n`;
                                        html += `                        <input type="text" name="${fieldName.toLowerCase()}"><br>\n`;
                                    }
                                });
                                html += `                        <input type="submit" value="Submit">\n`;
                                html += `                    </form>\n`;
                                break;
                            case "Divider":
                                html += `                    <hr class="${element.className}" style="${elementStyleString}">\n`;
                                break;
                            case "Custom HTML":
                                html += `                    ${element.content}\n`;
                                break;
                            default:
                                html += `                    <div class="${element.className}" style="${elementStyleString}">${element.content}</div>\n`;
                        }
                    });
                    
                    html += `                </div>\n`;
                });
                
                html += `            </div>\n`;
                html += `        </div>\n`;
            });
            
            html += `    </div>\n`;
            
            if (globalJS) {
                html += `    <script>\n        ${globalJS}\n    <\/script>\n`;
            }
            
            html += `</body>\n</html>`;
            
            return html;
        }

        // Export the webpage
        function exportWebpage() {
            const html = generateHTML();
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'webpage.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Import webpage from HTML
        function importWebpage() {
            // This is a simplified version - in a real app, you'd parse the HTML
            // and extract the sections, columns, and elements
            
            try {
                // This would be a complex HTML parser in a real implementation
                alert("Import functionality would parse the HTML and extract the layout here. This is a simplified demo.");
                
                // For demo purposes, just add a sample section
                addSection("2 Columns");
                
                // Close the modal
                showImportModal = false;
                renderApp();
            } catch (error) {
                alert("Error importing HTML: " + error.message);
            }
        }

        // Toggle mobile view
        function toggleMobileView() {
            isMobileView = !isMobileView;
            renderApp();
        }

        // Toggle sidebar
        function toggleSidebar() {
            isSidebarOpen = !isSidebarOpen;
            renderApp();
        }

        // Render the app
        function renderApp() {
            const root = document.getElementById('root');
            if (!root) return;
            
            // Save scroll position before rendering
            lastScrollPosition = window.scrollY;
            
            root.innerHTML = `
                <div class="flex h-full">
                    <!-- Sidebar Toggle Button (Mobile Only) -->
                    <div class="sidebar-toggle" onclick="toggleSidebar()">
                        <i class="fas ${isSidebarOpen ? 'fa-times' : 'fa-bars'}"></i> ${isSidebarOpen ? 'Close' : 'Open'} Sidebar
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="sidebar ${isSidebarOpen ? 'active' : ''}" style="width: 320px;">
                        <h1>Webpage Builder</h1>
                        
                        <!-- Tab Navigation -->
                        <div class="flex mb-4 bg-gray-100 p-1 rounded-lg">
                            <div class="w-1/2 text-center">
                                <button class="tab-button ${activeTab === 'content' ? 'active' : ''}" onclick="activeTab = 'content'; renderApp();" style="width: 100%;">
                                    <i class="fas fa-puzzle-piece"></i> Content
                                </button>
                            </div>
                            <div class="w-1/2 text-center">
                                <button class="tab-button ${activeTab === 'style' ? 'active' : ''}" onclick="activeTab = 'style'; renderApp();" style="width: 100%;">
                                    <i class="fas fa-paint-brush"></i> Style
                                </button>
                            </div>
                        </div>
                        
                        ${activeTab === 'content' ? renderContentTab() : ''}
                        ${activeTab === 'style' ? renderStyleTab() : ''}
                    </div>
                    
                    <!-- Main Content -->
                    <div class="flex-1">
                        <div class="preview-area">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold">Preview</h2>
                                <div class="flex space-x-2">
                                    <button onclick="toggleMobileView()" class="bg-blue-500 text-white px-4 py-2 rounded-lg">
                                        <i class="fas ${isMobileView ? 'fa-desktop' : 'fa-mobile-alt'}"></i> ${isMobileView ? 'Desktop View' : 'Mobile View'}
                                    </button>
                                    <button onclick="exportWebpage()" class="bg-green-500 text-white px-4 py-2 rounded-lg">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                    <button onclick="showImportModal = true; renderApp();" class="bg-purple-500 text-white px-4 py-2 rounded-lg">
                                        <i class="fas fa-upload"></i> Import
                                    </button>
                                </div>
                            </div>
                            
                            <div class="${isMobileView ? 'mobile-preview' : 'preview-container'}">
                                ${sections.length === 0 ? renderEmptyState() : ''}
                                ${sections.map(section => renderSection(section)).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                ${showExportModal ? renderExportModal() : ''}
                ${showImportModal ? renderImportModal() : ''}
            `;
            
            // Restore scroll position after rendering
            window.scrollTo(0, lastScrollPosition);
        }

        // Render content tab
        function renderContentTab() {
            return `
                <div>
                    <!-- Section Categories -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-2">Add Section</h3>
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${Object.keys(sectionCategories).map(category => `
                                <button 
                                    class="${selectedCategory === category ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'} px-3 py-1 rounded-lg text-sm" 
                                    onclick="selectedCategory = '${category}'; renderApp();">
                                    ${category}
                                </button>
                            `).join('')}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            ${sectionCategories[selectedCategory].map(type => `
                                <button 
                                    class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded-lg text-sm flex items-center justify-center" 
                                    onclick="addSection('${type}')">
                                    <i class="fas ${elementTypes[type]?.icon || 'fa-cube'} mr-1"></i> ${type}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Elements -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-2">Elements</h3>
                        <div class="grid grid-cols-2 gap-2">
                            ${Object.entries(elementTypes).map(([type, data]) => `
                                <div 
                                    class="draggable-item text-sm flex items-center justify-center" 
                                    draggable="true" 
                                    ondragstart="handleDragStart(event, '${type}')">
                                    <i class="fas ${data.icon} mr-1"></i> ${type}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${selectedSection ? renderSectionProperties() : ''}
                    ${selectedElement ? renderElementProperties() : ''}
                </div>
            `;
        }

        // Render style tab
        function renderStyleTab() {
            return `
                <div>
                    <!-- Global Styles -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-2">Global Styles</h3>
                        
                        <div class="style-control-group">
                            <h4>Custom CSS</h4>
                            <textarea 
                                class="custom-css-editor" 
                                placeholder="Add your custom CSS here..." 
                                onchange="globalCSS = this.value; renderApp();">${globalCSS}</textarea>
                        </div>
                        
                        <div class="style-control-group">
                            <h4>Custom JavaScript</h4>
                            <textarea 
                                class="custom-js-editor" 
                                placeholder="Add your custom JavaScript here..." 
                                onchange="globalJS = this.value; renderApp();">${globalJS}</textarea>
                        </div>
                    </div>
                    
                    ${selectedSection ? renderSectionStyleControls() : ''}
                    ${selectedElement ? renderElementStyleControls() : ''}
                    
                    ${!selectedSection && !selectedElement ? `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-paint-brush text-4xl mb-2"></i>
                            <p>Select a section or element to style it</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Render section properties
        function renderSectionProperties() {
            return `
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Section Properties</h3>
                    <div class="item-card">
                        <div class="item-card-header">
                            <span>${selectedSection.type}</span>
                            <button class="text-red-500 hover:text-red-700" onclick="removeSection(${selectedSection.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <!-- Column Layout Controls -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Columns: ${selectedSection.columns}</label>
                            <div class="flex space-x-2">
                                <button class="bg-blue-500 text-white px-3 py-1 rounded text-sm flex-1" onclick="addColumn(${selectedSection.id})">
                                    <i class="fas fa-plus"></i> Add Column
                                </button>
                                ${selectedSection.columns > 1 ? `
                                    <button class="bg-red-500 text-white px-3 py-1 rounded text-sm flex-1" onclick="removeColumn(${selectedSection.id}, 0)">
                                        <i class="fas fa-minus"></i> Remove Column
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Column Width Controls -->
                        ${selectedSection.widths.map((width, index) => `
                            <div class="width-control mb-2">
                                <label class="block text-sm font-medium mb-1">Column ${index + 1} Width</label>
                                <div class="flex items-center">
                                    <input 
                                        type="range" 
                                        min="10" 
                                        max="90" 
                                        value="${width}" 
                                        class="width-slider" 
                                        oninput="updateColumnWidth(${selectedSection.id}, ${index}, parseInt(this.value))">
                                    <input 
                                        type="number" 
                                        min="10" 
                                        max="90" 
                                        value="${Math.round(width)}" 
                                        class="width-input" 
                                        onchange="updateColumnWidth(${selectedSection.id}, ${index}, parseInt(this.value))">
                                    <span class="ml-1">%</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Render element properties
        function renderElementProperties() {
            return `
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Element Properties</h3>
                    <div class="item-card">
                        <div class="item-card-header">
                            <span>${selectedElement.type}</span>
                            <button class="text-red-500 hover:text-red-700" 
                                onclick="removeElement(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <!-- Content Editor -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Content</label>
                            ${selectedElement.type === 'Image' ? `
                                <input 
                                    type="text" 
                                    value="${selectedElement.content}" 
                                    placeholder="Image URL" 
                                    onchange="updateElementContent(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)">
                            ` : selectedElement.type === 'Custom HTML' ? `
                                <textarea 
                                    class="custom-html-editor" 
                                    onchange="updateElementContent(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)">${selectedElement.content}</textarea>
                            ` : `
                                <textarea 
                                    onchange="updateElementContent(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)">${selectedElement.content}</textarea>
                            `}
                        </div>
                        
                        <!-- Class Name -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">CSS Class</label>
                            <input 
                                type="text" 
                                value="${selectedElement.className}" 
                                onchange="updateElementClassName(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)">
                        </div>
                    </div>
                </div>
            `;
        }

        // Render section style controls
        function renderSectionStyleControls() {
            return `
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Section Styles</h3>
                    <div class="item-card">
                        <div class="item-card-header">
                            <span>${selectedSection.type}</span>
                        </div>
                        
                        <!-- Background Color -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Background Color</label>
                            <div class="color-picker-container">
                                <div class="color-preview" style="background-color: ${selectedSection.styles.backgroundColor || 'transparent'};"></div>
                                <input 
                                    type="text" 
                                    value="${selectedSection.styles.backgroundColor || ''}" 
                                    placeholder="e.g. #ffffff, transparent"
                                    onchange="updateSectionStyle(${selectedSection.id}, 'backgroundColor', this.value)">
                            </div>
                        </div>
                        
                        <!-- Padding -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Padding</label>
                            <input 
                                type="text" 
                                value="${selectedSection.styles.padding || ''}" 
                                placeholder="e.g. 16px, 10px 20px"
                                onchange="updateSectionStyle(${selectedSection.id}, 'padding', this.value)">
                        </div>
                        
                        <!-- Class Name -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">CSS Class</label>
                            <input 
                                type="text" 
                                value="${selectedSection.styles.className || ''}" 
                                onchange="updateSectionStyle(${selectedSection.id}, 'className', this.value)">
                        </div>
                    </div>
                </div>
            `;
        }

        // Render element style controls
        function renderElementStyleControls() {
            return `
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Element Styles</h3>
                    <div class="item-card">
                        <div class="item-card-header">
                            <span>${selectedElement.type}</span>
                        </div>
                        
                        <!-- Text Color -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Text Color</label>
                            <div class="color-picker-container">
                                <div class="color-preview" style="background-color: ${selectedElement.styles.color || '#000000'};"></div>
                                <input 
                                    type="text" 
                                    value="${selectedElement.styles.color || ''}" 
                                    placeholder="e.g. #000000"
                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'color', this.value)">
                            </div>
                        </div>
                        
                        <!-- Background Color -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Background Color</label>
                            <div class="color-picker-container">
                                <div class="color-preview" style="background-color: ${selectedElement.styles.backgroundColor || 'transparent'};"></div>
                                <input 
                                    type="text" 
                                    value="${selectedElement.styles.backgroundColor || ''}" 
                                    placeholder="e.g. #ffffff, transparent"
                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'backgroundColor', this.value)">
                            </div>
                        </div>
                        
                        <!-- Font Size -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Font Size</label>
                            <input 
                                type="text" 
                                value="${selectedElement.styles.fontSize || ''}" 
                                placeholder="e.g. 16px, 1rem"
                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'fontSize', this.value)">
                        </div>
                        
                        <!-- Text Alignment -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Text Alignment</label>
                            <select onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'textAlign', this.value)">
                                <option value="left" ${selectedElement.styles.textAlign === 'left' ? 'selected' : ''}>Left</option>
                                <option value="center" ${selectedElement.styles.textAlign === 'center' ? 'selected' : ''}>Center</option>
                                <option value="right" ${selectedElement.styles.textAlign === 'right' ? 'selected' : ''}>Right</option>
                                <option value="justify" ${selectedElement.styles.textAlign === 'justify' ? 'selected' : ''}>Justify</option>
                            </select>
                        </div>
                        
                        <!-- Padding -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Padding</label>
                            <input 
                                type="text" 
                                value="${selectedElement.styles.padding || ''}" 
                                placeholder="e.g. 10px, 5px 10px"
                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'padding', this.value)">
                        </div>
                        
                        <!-- Margin -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Margin</label>
                            <input 
                                type="text" 
                                value="${selectedElement.styles.margin || ''}" 
                                placeholder="e.g. 10px, 5px 10px"
                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'margin', this.value)">
                        </div>
                        
                        <!-- Border -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Border</label>
                            <input 
                                type="text" 
                                value="${selectedElement.styles.border || ''}" 
                                placeholder="e.g. 1px solid #ccc"
                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'border', this.value)">
                        </div>
                        
                        <!-- Border Radius -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Border Radius</label>
                            <input 
                                type="text" 
                                value="${selectedElement.styles.borderRadius || ''}" 
                                placeholder="e.g. 4px, 50%"
                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'borderRadius', this.value)">
                        </div>
                        
                        <!-- Width -->
                        <div class="mb-3">
                            <label class="block text-sm font-medium mb-1">Width</label>
                            <input 
                                type="text" 
                                value="${selectedElement.styles.width || ''}" 
                                placeholder="e.g. 100%, 200px"
                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'width', this.value)">
                        </div>
                    </div>
                </div>
            `;
        }

        // Render a section
        function renderSection(section) {
            const isSelected = selectedSection && selectedSection.id === section.id;
            
            return `
                <div 
                    class="section-preview ${isSelected ? 'selected-section' : ''}" 
                    onclick="selectedSection = ${JSON.stringify(section).replace(/"/g, '&quot;')}; selectedColumn = null; selectedElement = null; renderApp();"
                    style="${Object.entries(section.styles || {}).map(([key, value]) => {
                        if (key === 'className') return '';
                        const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                        return `${cssKey}: ${value};`;
                    }).join(' ')}"
                >
                    <div class="section-header p-2 bg-gray-100 text-center text-sm font-medium">
                        ${section.type} (${section.columns} Column${section.columns !== 1 ? 's' : ''})
                    </div>
                    
                    <div class="grid-layout" style="grid-template-columns: ${section.widths.map(w => `${w}%`).join(' ')};">
                        ${section.elements.map((column, colIndex) => {
                            const isColSelected = isSelected && selectedColumn === colIndex;
                            
                            return `
                                <div 
                                    class="column ${isColSelected ? 'border-2 border-blue-500' : ''}" 
                                    onclick="event.stopPropagation(); selectedSection = ${JSON.stringify(section).replace(/"/g, '&quot;')}; selectedColumn = ${colIndex}; selectedElement = null; renderApp();"
                                    ondrop="handleDrop(event, ${section.id}, ${colIndex})" 
                                    ondragover="handleDragOver(event)" 
                                    ondragleave="handleDragLeave(event)"
                                    style="justify-content: ${section.columnAlignments[colIndex] || 'center'};"
                                >
                                    <div class="column-resize-handle" onclick="event.stopPropagation();"></div>
                                    
                                    <div class="column-content">
                                        ${column.length === 0 ? `
                                            <div class="drop-zone text-center text-gray-400 p-4">
                                                <i class="fas fa-arrow-down mb-1"></i>
                                                <p>Drop elements here</p>
                                            </div>
                                        ` : ''}
                                        
                                        ${column.map(element => {
                                            const isElementSelected = selectedElement && selectedElement.id === element.id;
                                            
                                            return `
                                                <div 
                                                    class="element ${isElementSelected ? 'border-blue-500 bg-blue-50' : ''}" 
                                                    onclick="event.stopPropagation(); selectedSection = ${JSON.stringify(section).replace(/"/g, '&quot;')}; selectedColumn = ${colIndex}; selectedElement = ${JSON.stringify(element).replace(/"/g, '&quot;')}; renderApp();"
                                                    style="${Object.entries(element.styles || {}).map(([key, value]) => {
                                                        if (key === 'className') return '';
                                                        const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                                                        return `${cssKey}: ${value};`;
                                                    }).join(' ')}"
                                                >
                                                    ${renderElementContent(element)}
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                    
                                    <!-- Column Alignment Controls -->
                                    ${isColSelected ? `
                                        <div class="mt-2 p-2 bg-gray-100 rounded">
                                            <label class="block text-sm font-medium mb-1">Column Alignment</label>
                                            <div class="alignment-buttons">
                                                <div class="alignment-btn ${section.columnAlignments[colIndex] === 'flex-start' ? 'active' : ''}" 
                                                     onclick="updateColumnAlignment(${section.id}, ${colIndex}, 'flex-start')">
                                                    <i class="fas fa-align-left"></i>
                                                    <div>Left</div>
                                                </div>
                                                <div class="alignment-btn ${section.columnAlignments[colIndex] === 'center' ? 'active' : ''}" 
                                                     onclick="updateColumnAlignment(${section.id}, ${colIndex}, 'center')">
                                                    <i class="fas fa-align-center"></i>
                                                    <div>Center</div>
                                                </div>
                                                <div class="alignment-btn ${section.columnAlignments[colIndex] === 'flex-end' ? 'active' : ''}" 
                                                     onclick="updateColumnAlignment(${section.id}, ${colIndex}, 'flex-end')">
                                                    <i class="fas fa-align-right"></i>
                                                    <div>Right</div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Render element content based on type
        function renderElementContent(element) {
            switch (element.type) {
                case "Text":
                    return `<div>${element.content}</div>`;
                case "Image":
                    return `<img src="${element.content}" alt="Image" style="max-width: 100%; height: auto;">`;
                case "Button":
                    return `<button class="element-button" style="
                        background-color: ${element.styles.backgroundColor || '#3b82f6'}; 
                        color: ${element.styles.color || 'white'}; 
                        padding: ${element.styles.padding || '10px 20px'}; 
                        border-radius: ${element.styles.borderRadius || '6px'};
                        border: ${element.styles.border || 'none'};
                        font-weight: ${element.styles.fontWeight || 'bold'};
                    ">${element.content}</button>`;
                case "Heading":
                    return `<h3>${element.content}</h3>`;
                case "Paragraph":
                    return `<p>${element.content}</p>`;
                case "Card":
                    const cardContent = element.content.split('\n');
                    return `
                        <div style="
                            background-color: ${element.styles.backgroundColor || '#ffffff'}; 
                            padding: ${element.styles.padding || '20px'}; 
                            border-radius: ${element.styles.borderRadius || '8px'};
                            border: ${element.styles.border || '1px solid #e5e7eb'};
                            box-shadow: ${element.styles.boxShadow || '0 2px 4px rgba(0,0,0,0.1)'};
                        ">
                            ${cardContent[0] ? `<h4>${cardContent[0]}</h4>` : ''}
                            ${cardContent[1] ? `<p>${cardContent[1]}</p>` : ''}
                        </div>
                    `;
                case "Form":
                    const formContent = element.content.split('\n');
                    return `
                        <form style="
                            background-color: ${element.styles.backgroundColor || '#f9fafb'}; 
                            padding: ${element.styles.padding || '20px'}; 
                            border-radius: ${element.styles.borderRadius || '8px'};
                            border: ${element.styles.border || '1px solid #e5e7eb'};
                        ">
                            ${formContent.map(field => {
                                if (field.trim()) {
                                    const fieldName = field.replace(':', '');
                                    return `
                                        <div class="mb-2">
                                            <label>${fieldName}</label>
                                            <input type="text" name="${fieldName.toLowerCase()}" class="w-full p-1 border rounded">
                                        </div>
                                    `;
                                }
                                return '';
                            }).join('')}
                            <input type="submit" value="Submit" class="bg-blue-500 text-white px-3 py-1 rounded mt-2">
                        </form>
                    `;
                case "Divider":
                    return `<hr style="
                        height: ${element.styles.height || '1px'}; 
                        background-color: ${element.styles.backgroundColor || '#e5e7eb'}; 
                        margin: ${element.styles.margin || '20px 0'};
                        border: ${element.styles.border || 'none'};
                    ">`;
                case "Custom HTML":
                    return `<div>${element.content}</div>`;
                default:
                    return `<div>${element.content}</div>`;
            }
        }

        // Render empty state
        function renderEmptyState() {
            return `
                <div class="text-center py-12 text-gray-500">
                    <i class="fas fa-plus-circle text-4xl mb-4"></i>
                    <h3 class="text-xl font-medium mb-2">No Sections Added Yet</h3>
                    <p>Start by adding a section from the sidebar</p>
                </div>
            `;
        }

        // Render export modal
        function renderExportModal() {
            const htmlCode = generateHTML();
            
            return `
                <div class="modal">
                    <div class="modal-content">
                        <h2 class="text-xl font-bold mb-4">Export Webpage</h2>
                        <p class="mb-4">Your HTML code is ready. You can copy it or download as a file.</p>
                        
                        <textarea class="w-full h-64 p-3 bg-gray-100 rounded mb-4" readonly>${htmlCode}</textarea>
                        
                        <div class="flex justify-end space-x-2">
                            <button onclick="showExportModal = false; renderApp();" class="bg-gray-500 text-white px-4 py-2 rounded">
                                Cancel
                            </button>
                            <button onclick="navigator.clipboard.writeText(\`${htmlCode.replace(/`/g, '\\`')}\'); alert('Copied to clipboard!');" class="bg-blue-500 text-white px-4 py-2 rounded">
                                Copy to Clipboard
                            </button>
                            <button onclick="exportWebpage(); showExportModal = false;" class="bg-green-500 text-white px-4 py-2 rounded">
                                Download HTML
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render import modal
        function renderImportModal() {
            return `
                <div class="modal">
                    <div class="modal-content">
                        <h2 class="text-xl font-bold mb-4">Import Webpage</h2>
                        <p class="mb-4">Paste your HTML code below to import a webpage.</p>
                        
                        <textarea 
                            class="w-full h-64 p-3 bg-gray-100 rounded mb-4" 
                            placeholder="Paste your HTML code here..."
                            onchange="importHtml = this.value"></textarea>
                        
                        <div class="flex justify-end space-x-2">
                            <button onclick="showImportModal = false; renderApp();" class="bg-gray-500 text-white px-4 py-2 rounded">
                                Cancel
                            </button>
                            <button onclick="importWebpage();" class="bg-green-500 text-white px-4 py-2 rounded">
                                Import
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize the app
        function initApp() {
            // Add a default section to start with
            addSection("2 Columns");
            
            // Render the app
            renderApp();
        }

        // Start the app
        initApp();
    </script>
</body>
</html>
