<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Webpage Builder</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            min-height: 100vh;
            line-height: 1.6;
        }

        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .sidebar {
            background-color: #ffffff;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            overflow-y: auto;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .sidebar h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }

        .preview-area {
            background-color: #f3f4f6;
            padding: 1.5rem;
            min-height: 100vh;
            flex-grow: 1;
        }

        .preview-container {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .section-preview {
            transition: all 0.3s ease;
            border-radius: 0.5rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            min-height: 100px;
        }

        .section-preview:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .selected-section {
            border: 2px solid #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
            border-radius: 0.5rem;
        }

        button {
            transition: all 0.2s ease;
            font-weight: 500;
            min-height: 44px;
            padding: 0.6rem 1rem;
        }

        button:hover {
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        input, select, textarea {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.6rem;
            width: 100%;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            min-height: 44px;
            cursor: text;
            resize: vertical;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .item-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .item-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .mobile-preview {
            width: 375px;
            margin: 0 auto;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background: #f3f4f6;
            color: #4b5563;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-button.active {
            background: #3b82f6;
            color: white;
        }

        .link-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .column-layout {
            display: grid;
            gap: 1rem;
        }

        .draggable-item {
            padding: 1rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s;
        }

        .draggable-item:hover {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .drop-zone.active {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }

        .column {
            position: relative;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background: #f9fafb;
            min-height: 100px;
        }

        .column-resize-handle {
            position: absolute;
            top: 0;
            right: -5px;
            width: 10px;
            height: 100%;
            cursor: col-resize;
            background: transparent;
            z-index: 10;
        }

        .column-resize-handle:hover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 4px;
            width: 2px;
            height: 100%;
            background: #3b82f6;
        }

        .column-content {
            min-height: 50px;
            padding: 0.5rem;
        }

        .element {
            padding: 0.75rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            cursor: move;
        }

        .element:hover {
            border-color: #3b82f6;
        }

        .grid-layout {
            display: grid;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .width-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .width-slider {
            flex: 1;
        }

        .width-input {
            width: 60px;
        }

        .style-control-group {
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .style-control-group h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
        }

        .range-value {
            min-width: 40px;
            text-align: right;
            font-size: 0.875rem;
        }

        .section-header {
            display: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .sidebar-toggle {
            display: none;
            padding: 0.5rem 1rem;
            background: #3b82f6;
            color: white;
            border-radius: 0.375rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .input-with-unit {
            display: flex;
            align-items: center;
        }
        
        .input-with-unit input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }
        
        .input-with-unit .unit {
            background: #f3f4f6;
            padding: 0 0.75rem;
            height: 44px;
            display: flex;
            align-items: center;
            border-top-right-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            border: 1px solid #d1d5db;
            border-left: none;
        }

        .gradient-preview {
            width: 100%;
            height: 60px;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            margin-bottom: 0.5rem;
        }

        .alignment-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .alignment-btn {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alignment-btn.active {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }

        .alignment-btn i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .custom-css-editor {
            font-family: monospace;
            min-height: 120px;
        }

        @media (max-width: 768px) {
            .flex {
                flex-direction: column;
            }

            .sidebar {
                display: none;
                height: auto;
                position: static;
                padding: 1rem;
            }

            .sidebar.active {
                display: block;
            }

            .sidebar-toggle {
                display: block;
            }

            .preview-container {
                padding: 1rem;
                max-width: 100%;
            }

            .grid-layout {
                grid-template-columns: 1fr !important;
            }

            button, input, select, textarea {
                font-size: 1rem;
                min-height: 44px;
            }
        }

        @media (max-width: 480px) {
            .preview-container {
                padding: 0.5rem;
            }

            .properties-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // Section types with categories
        const sectionCategories = {
            "Layout": ["1 Column", "2 Columns", "3 Columns"],
            "Content": ["Text", "Image", "Button", "Heading", "Paragraph"],
            "Elements": ["Card", "Form", "Divider", "Custom HTML"]
        };

        // Font options
        const fontOptions = [
            "Inter, sans-serif",
            "Arial, sans-serif",
            "Helvetica, sans-serif",
            "Georgia, serif",
            "Times New Roman, serif",
            "Courier New, monospace",
            "Verdana, sans-serif",
            "Impact, sans-serif"
        ];

        // Element types with safe default styles
        const elementTypes = {
            "Text": { 
                icon: "fa-font", 
                defaultContent: "This is a text element. You can edit me!",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#000000",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "normal",
                    textAlign: "left",
                    lineHeight: "1.5",
                    padding: "0px",
                    margin: "0px",
                    backgroundColor: "transparent",
                    border: "none",
                    borderRadius: "0px",
                    width: "auto",
                    height: "auto",
                    backgroundImage: "none",
                    className: "text-element"
                }
            },
            "Image": { 
                icon: "fa-image", 
                defaultContent: "https://via.placeholder.com/300x200",
                defaultStyles: {
                    width: "100%",
                    maxWidth: "300px",
                    height: "auto",
                    padding: "0px",
                    margin: "0px auto",
                    border: "none",
                    borderRadius: "0px",
                    color: "#000000",
                    display: "block",
                    objectFit: "contain",
                    className: "image-element"
                }
            },
            "Button": { 
                icon: "fa-square", 
                defaultContent: "Click Me",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#ffffff",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "bold",
                    padding: "10px 20px",
                    margin: "0px",
                    backgroundColor: "#3b82f6",
                    border: "none",
                    borderRadius: "6px",
                    textAlign: "center",
                    width: "auto",
                    height: "auto",
                    className: "button-element"
                }
            },
            "Heading": { 
                icon: "fa-heading", 
                defaultContent: "This is a Heading",
                defaultStyles: {
                    fontSize: "24px",
                    color: "#000000",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "bold",
                    textAlign: "left",
                    lineHeight: "1.2",
                    padding: "0px",
                    margin: "0px 0px 16px 0px",
                    backgroundColor: "transparent",
                    border: "none",
                    borderRadius: "0px",
                    width: "auto",
                    height: "auto",
                    className: "heading-element"
                }
            },
            "Paragraph": { 
                icon: "fa-paragraph", 
                defaultContent: "This is a paragraph of text. You can replace it with your own content.",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#333333",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "normal",
                    textAlign: "left",
                    lineHeight: "1.6",
                    padding: "0px",
                    margin: "0px 0px 16px 0px",
                    backgroundColor: "transparent",
                    border: "none",
                    borderRadius: "0px",
                    width: "auto",
                    height: "auto",
                    className: "paragraph-element"
                }
            },
            "Card": { 
                icon: "fa-id-card", 
                defaultContent: "Card Title\nCard content goes here.",
                defaultStyles: {
                    fontSize: "16px",
                    color: "#000000",
                    fontFamily: "Inter, sans-serif",
                    fontWeight: "normal",
                    textAlign: "left",
                    lineHeight: "1.5",
                    padding: "20px",
                    margin: "0px",
                    backgroundColor: "#ffffff",
                    border: "1px solid #e5e7eb",
                    borderRadius: "8px",
                    boxShadow: "0 2px 4px rgba(0,0,0,0.1)",
                    width: "auto",
                    height: "auto",
                    className: "card-element"
                }
            },
            "Form": {
                icon: "fa-window-restore",
                defaultContent: "Name:\nEmail:\nMessage:",
                defaultStyles: {
                    padding: "20px",
                    margin: "0px",
                    backgroundColor: "#f9fafb",
                    border: "1px solid #e5e7eb",
                    borderRadius: "8px",
                    width: "auto",
                    height: "auto",
                    color: "#000000",
                    className: "form-element"
                }
            },
            "Divider": {
                icon: "fa-minus",
                defaultContent: "",
                defaultStyles: {
                    height: "1px",
                    backgroundColor: "#e5e7eb",
                    margin: "20px 0",
                    border: "none",
                    width: "100%",
                    className: "divider-element"
                }
            },
            "Custom HTML": {
                icon: "fa-code",
                defaultContent: "<div class='custom-content'>\n  <h3>Custom HTML</h3>\n  <p>You can add any HTML content here</p>\n</div>",
                defaultStyles: {
                    padding: "20px",
                    margin: "0px",
                    backgroundColor: "#f0f9ff",
                    border: "1px dashed #3b82f6",
                    borderRadius: "8px",
                    width: "auto",
                    height: "auto",
                    className: "custom-html-element"
                }
            }
        };

        // Templates for different section types with safe defaults
        const templates = {
            "1 Column": {
                columns: 1,
                widths: [100],
                elements: [],
                styles: {
                    display: "flex",
                    flexDirection: "row",
                    gap: "16px",
                    backgroundColor: "transparent",
                    padding: "16px",
                    color: "#000000",
                    className: "section-1col"
                }
            },
            "2 Columns": {
                columns: 2,
                widths: [50, 50],
                elements: [],
                styles: {
                    display: "flex",
                    flexDirection: "row",
                    gap: "16px",
                    backgroundColor: "transparent",
                    padding: "16px",
                    color: "#000000",
                    className: "section-2col"
                }
            },
            "3 Columns": {
                columns: 3,
                widths: [33.33, 33.33, 33.33],
                elements: [],
                styles: {
                    display: "flex",
                    flexDirection: "row",
                    gap: "16px",
                    backgroundColor: "transparent",
                    padding: "16px",
                    color: "#000000",
                    className: "section-3col"
                }
            }
        };

        // State management
        let sections = [];
        let selectedSection = null;
        let selectedColumn = null;
        let selectedElement = null;
        let isMobileView = false;
        let activeTab = 'content';
        let draggedElement = null;
        let selectedCategory = 'Layout';
        let htmlExport = '';
        let showExportModal = false;
        let showImportModal = false;
        let importHtml = '';
        let isSidebarOpen = false;

        // Validate style value
        function isValidStyleValue(property, value) {
            if (!value || value.trim() === '') return false;
            
            // Special handling for background gradients
            if (property === 'backgroundImage') {
                return value === 'none' || value.includes('gradient') || value.includes('url');
            }
            
            if (['fontSize', 'lineHeight', 'width', 'maxWidth', 'height', 'borderRadius'].includes(property)) {
                if (property === 'lineHeight') {
                    return !isNaN(parseFloat(value)) || value === 'normal';
                }
                return /^[0-9]+(px|%|rem|em|vw|vh)?$/.test(value);
            }
            if (['color', 'backgroundColor'].includes(property)) {
                return /^#[0-9A-Fa-f]{6}$|^#[0-9A-Fa-f]{3}$|^transparent$|^[a-zA-Z]+$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/.test(value);
            }
            if (['padding', 'margin', 'border'].includes(property)) {
                return /^[0-9]+(px|%|rem|em)?(\s[0-9]+(px|%|rem|em)?)*$|^none$|^auto$/.test(value);
            }
            return true;
        }

        // Add a new section
        function addSection(type) {
            if (!type) return;
            
            let newSection;
            
            if (templates[type]) {
                newSection = {
                    id: Date.now(),
                    type,
                    columns: templates[type].columns,
                    widths: [...templates[type].widths],
                    elements: Array(templates[type].columns).fill().map(() => []),
                    styles: { ...templates[type].styles }
                };
            } else {
                newSection = {
                    id: Date.now(),
                    type,
                    columns: 1,
                    widths: [100],
                    elements: [[]],
                    styles: {
                        display: "flex",
                        flexDirection: "row",
                        gap: "16px",
                        backgroundColor: "transparent",
                        padding: "16px",
                        color: "#000000",
                        className: `section-${type.toLowerCase().replace(/\s+/g, '-')}`
                    }
                };
            }
            
            sections = [...sections, newSection];
            selectedSection = newSection;
            selectedColumn = null;
            selectedElement = null;
            renderApp();
        }

        // Remove a section
        function removeSection(sectionId) {
            sections = sections.filter(section => section.id !== sectionId);
            if (selectedSection && selectedSection.id === sectionId) {
                selectedSection = null;
                selectedColumn = null;
                selectedElement = null;
            }
            renderApp();
        }

        // Add a column to a section
        function addColumn(sectionId) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newWidth = 100 / (section.columns + 1);
                    const newWidths = section.widths.map(width => width * (section.columns / (section.columns + 1)));
                    newWidths.push(newWidth);
                    
                    return {
                        ...section,
                        columns: section.columns + 1,
                        widths: newWidths,
                        elements: [...section.elements, []]
                    };
                }
                return section;
            });
            renderApp();
        }

        // Remove a column from a section
        function removeColumn(sectionId, columnIndex) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    if (section.columns <= 1) return section;
                    
                    const removedWidth = section.widths[columnIndex];
                    const newWidths = section.widths.filter((_, i) => i !== columnIndex);
                    const widthRatio = 100 / (100 - removedWidth);
                    const adjustedWidths = newWidths.map(width => width * widthRatio);
                    
                    return {
                        ...section,
                        columns: section.columns - 1,
                        widths: adjustedWidths,
                        elements: section.elements.filter((_, i) => i !== columnIndex)
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update column width
        function updateColumnWidth(sectionId, columnIndex, newWidth) {
            if (isNaN(newWidth) || newWidth < 10 || newWidth > 90) return;
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const oldWidth = section.widths[columnIndex];
                    const widthDiff = newWidth - oldWidth;
                    const remainingColumns = section.columns - 1;
                    
                    const adjustmentPerColumn = -widthDiff / remainingColumns;
                    
                    const newWidths = section.widths.map((width, i) => {
                        if (i === columnIndex) return newWidth;
                        return width + adjustmentPerColumn;
                    });
                    
                    return {
                        ...section,
                        widths: newWidths
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update section layout style
        function updateSectionStyle(sectionId, styleProperty, value) {
            if (!isValidStyleValue(styleProperty, value)) return;
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    return {
                        ...section,
                        styles: {
                            ...section.styles,
                            [styleProperty]: value
                        }
                    };
                }
                return section;
            });
            renderApp();
        }

        // Handle drag start for elements
        function handleDragStart(e, elementType) {
            draggedElement = elementType;
            e.dataTransfer.setData('text/plain', elementType);
            e.dataTransfer.effectAllowed = 'move';
        }

        // Handle drag over for drop zones
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('active');
        }

        // Handle drag leave for drop zones
        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('active');
        }

        // Handle drop for adding elements
        function handleDrop(e, sectionId, columnIndex) {
            e.preventDefault();
            e.currentTarget.classList.remove('active');
            
            const elementType = e.dataTransfer.getData('text/plain');
            if (!elementType) return;
            
            const newElement = {
                id: Date.now(),
                type: elementType,
                content: elementTypes[elementType].defaultContent,
                styles: {...elementTypes[elementType].defaultStyles},
                customCSS: "",
                className: `${elementType.toLowerCase().replace(/\s+/g, '-')}-${Date.now()}`
            };
            
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = [...section.elements];
                    newElements[columnIndex] = [...newElements[columnIndex], newElement];
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Handle element content update
        function updateElementContent(sectionId, columnIndex, elementId, newContent) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        content: newContent || elementTypes[element.type].defaultContent
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Handle element style update
        function updateElementStyle(sectionId, columnIndex, elementId, styleProperty, value) {
            if (!isValidStyleValue(styleProperty, value)) return;
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        styles: {
                                            ...element.styles,
                                            [styleProperty]: value
                                        }
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update element custom CSS
        function updateElementCustomCSS(sectionId, columnIndex, elementId, customCSS) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        customCSS: customCSS
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Update element class name
        function updateElementClassName(sectionId, columnIndex, elementId, className) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.map(element => {
                                if (element.id === elementId) {
                                    return {
                                        ...element,
                                        className: className
                                    };
                                }
                                return element;
                            });
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            renderApp();
        }

        // Remove an element
        function removeElement(sectionId, columnIndex, elementId) {
            sections = sections.map(section => {
                if (section.id === sectionId) {
                    const newElements = section.elements.map((column, cIndex) => {
                        if (cIndex === columnIndex) {
                            return column.filter(element => element.id !== elementId);
                        }
                        return column;
                    });
                    
                    return {
                        ...section,
                        elements: newElements
                    };
                }
                return section;
            });
            
            if (selectedElement && selectedElement.id === elementId) {
                selectedElement = null;
            }
            renderApp();
        }

        // Generate HTML from the current layout
        function generateHTML() {
            let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Webpage</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -15px;
        }
        .column {
            padding: 0 15px;
            box-sizing: border-box;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        /* Custom CSS from elements */\n`;

            // Add custom CSS from all elements
            sections.forEach(section => {
                section.elements.forEach(column => {
                    column.forEach(element => {
                        if (element.customCSS && element.customCSS.trim() !== '') {
                            html += `        .${element.className} {\n`;
                            html += `            ${element.customCSS.replace(/\n/g, '\n            ')}\n`;
                            html += `        }\n\n`;
                        }
                    });
                });
            });

            html += `        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }
            .column {
                width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">\n`;

            sections.forEach(section => {
                const styleString = Object.entries(section.styles || {}).map(([key, value]) => {
                    if (key === 'className') return '';
                    const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                    return `${cssKey}: ${value};`;
                }).join(' ');
                
                html += `        <div class="section ${section.styles.className || ''}" style="${styleString}">\n`;
                html += `            <div class="row">\n`;
                
                section.elements.forEach((column, colIndex) => {
                    const width = section.widths[colIndex];
                    html += `                <div class="column" style="width: ${width}%">\n`;
                    
                    column.forEach(element => {
                        const elementStyleString = Object.entries(element.styles || {}).map(([key, value]) => {
                            if (key === 'className') return '';
                            const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                            return `${cssKey}: ${value};`;
                        }).join(' ');
                        
                        switch (element.type) {
                            case "Text":
                                html += `                    <div class="${element.className}" style="${elementStyleString}">${element.content}</div>\n`;
                                break;
                            case "Image":
                                html += `                    <img src="${element.content}" alt="Image" class="${element.className}" style="${elementStyleString}">\n`;
                                break;
                            case "Button":
                                html += `                    <a href="#" class="btn ${element.className}" style="${elementStyleString}">${element.content}</a>\n`;
                                break;
                            case "Heading":
                                html += `                    <h2 class="${element.className}" style="${elementStyleString}">${element.content}</h2>\n`;
                                break;
                            case "Paragraph":
                                html += `                    <p class="${element.className}" style="${elementStyleString}">${element.content}</p>\n`;
                                break;
                            case "Card":
                                const cardContent = element.content.split('\n');
                                html += `                    <div class="card ${element.className}" style="${elementStyleString}">\n`;
                                html += `                        <h3>${cardContent[0] || "Card Title"}</h3>\n`;
                                html += `                        <p>${cardContent[1] || "Card content"}</p>\n`;
                                html += `                    </div>\n`;
                                break;
                            case "Form":
                                const formFields = element.content.split('\n');
                                html += `                    <form class="${element.className}" style="${elementStyleString}">\n`;
                                formFields.forEach(field => {
                                    if (field.trim()) {
                                        html += `                        <div style="margin-bottom: 15px;">\n`;
                                        html += `                            <label>${field}</label>\n`;
                                        html += `                            <input type="text" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">\n`;
                                        html += `                        </div>\n`;
                                    }
                                });
                                html += `                        <button type="submit" class="btn">Submit</button>\n`;
                                html += `                    </form>\n`;
                                break;
                            case "Divider":
                                html += `                    <hr class="${element.className}" style="${elementStyleString}">\n`;
                                break;
                            case "Custom HTML":
                                html += `                    ${element.content}\n`;
                                break;
                            default:
                                html += `                    <div class="${element.className}" style="${elementStyleString}">${element.content}</div>\n`;
                        }
                    });
                    
                    html += `                </div>\n`;
                });
                
                html += `            </div>\n`;
                html += `        </div>\n`;
            });
            
            html += `    </div>\n`;
            html += `</body>\n`;
            html += `</html>`;
            
            return html;
        }

        // Copy HTML to clipboard
        function copyHTML() {
            const html = generateHTML();
            navigator.clipboard.writeText(html).then(() => {
                alert("HTML copied to clipboard!");
            }).catch(err => {
                console.error("Failed to copy HTML: ", err);
            });
        }

        // Export HTML to file
        function exportHTML() {
            const html = generateHTML();
            htmlExport = html;
            showExportModal = true;
            renderApp();
        }

        // Download HTML file
        function downloadHTML() {
            const blob = new Blob([htmlExport], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'website.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import HTML
        function importHTML() {
            if (!importHtml.trim()) {
                alert("Please enter valid HTML content");
                return;
            }
            try {
                sections = [];
                selectedSection = null;
                selectedElement = null;
                
                const newSection = {
                    id: Date.now(),
                    type: "Imported",
                    columns: 1,
                    widths: [100],
                    elements: [[{
                        id: Date.now(),
                        type: "Text",
                        content: "Imported content. This is a basic implementation. A full HTML parser would be needed for complete import functionality.",
                        styles: elementTypes["Text"].defaultStyles,
                        customCSS: "",
                        className: "imported-element"
                    }]],
                    styles: {
                        display: "flex",
                        flexDirection: "row",
                        gap: "16px",
                        backgroundColor: "transparent",
                        padding: "16px",
                        color: "#000000",
                        className: "imported-section"
                    }
                };
                
                sections = [newSection];
                showImportModal = false;
                importHtml = '';
                renderApp();
                
                alert("HTML imported successfully (basic implementation)");
            } catch (err) {
                console.error("Failed to import HTML: ", err);
                alert("Error importing HTML");
            }
        }

        // Preview in new tab
        function previewInNewTab() {
            const html = generateHTML();
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        // Set text alignment
        function setTextAlignment(alignment) {
            if (!selectedElement) return;
            updateElementStyle(selectedSection.id, selectedColumn, selectedElement.id, 'textAlign', alignment);
        }

        // Set image alignment
        function setImageAlignment(alignment) {
            if (!selectedElement || selectedElement.type !== 'Image') return;
            
            let marginValue = '0px';
            if (alignment === 'center') marginValue = '0px auto';
            else if (alignment === 'right') marginValue = '0px 0px 0px auto';
            
            updateElementStyle(selectedSection.id, selectedColumn, selectedElement.id, 'margin', marginValue);
        }

        // Set background gradient
        function setBackgroundGradient(gradientType) {
            if (!selectedElement) return;
            
            let gradientValue = 'none';
            const color1 = selectedElement.styles.backgroundColor || '#3b82f6';
            const color2 = color1.replace(/\d+\)/, '0.8)');
            
            switch(gradientType) {
                case 'linear':
                    gradientValue = `linear-gradient(135deg, ${color1}, ${color2})`;
                    break;
                case 'radial':
                    gradientValue = `radial-gradient(circle, ${color1}, ${color2})`;
                    break;
                case 'none':
                default:
                    gradientValue = 'none';
            }
            
            updateElementStyle(selectedSection.id, selectedColumn, selectedElement.id, 'backgroundImage', gradientValue);
        }

        // Render element based on type
        function renderElement(element) {
            const style = element.styles || {};
            const customStyle = element.customCSS ? ` style="${element.customCSS}"` : '';
            
            switch (element.type) {
                case "Text":
                    return `<div class="${style.className}" style="
                        font-size: ${style.fontSize || "16px"};
                        color: ${style.color || "#000000"};
                        font-family: ${style.fontFamily || "Inter, sans-serif"};
                        font-weight: ${style.fontWeight || "normal"};
                        text-align: ${style.textAlign || "left"};
                        line-height: ${style.lineHeight || "1.5"};
                        padding: ${style.padding || "0px"};
                        margin: ${style.margin || "0px"};
                        background-color: ${style.backgroundColor || "transparent"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "none"};
                        border-radius: ${style.borderRadius || "0px"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                    " ${customStyle}>${element.content}</div>`;
                case "Image":
                    return `<img src="${element.content}" alt="Image" class="${style.className}" style="
                        width: ${style.width || "100%"};
                        max-width: ${style.maxWidth || "300px"};
                        height: ${style.height || "auto"};
                        padding: ${style.padding || "0px"};
                        margin: ${style.margin || "0px auto"};
                        border: ${style.border || "none"};
                        border-radius: ${style.borderRadius || "0px"};
                        object-fit: ${style.objectFit || "contain"};
                        display: ${style.display || "block"};
                    " ${customStyle}>`;
                case "Button":
                    return `<button class="${style.className}" style="
                        font-size: ${style.fontSize || "16px"};
                        color: ${style.color || "#ffffff"};
                        font-family: ${style.fontFamily || "Inter, sans-serif"};
                        font-weight: ${style.fontWeight || "bold"};
                        padding: ${style.padding || "10px 20px"};
                        margin: ${style.margin || "0px"};
                        background-color: ${style.backgroundColor || "#3b82f6"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "none"};
                        border-radius: ${style.borderRadius || "6px"};
                        text-align: ${style.textAlign || "center"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                        cursor: pointer;
                    " ${customStyle}>${element.content}</button>`;
                case "Heading":
                    return `<h2 class="${style.className}" style="
                        font-size: ${style.fontSize || "24px"};
                        color: ${style.color || "#000000"};
                        font-family: ${style.fontFamily || "Inter, sans-serif"};
                        font-weight: ${style.fontWeight || "bold"};
                        text-align: ${style.textAlign || "left"};
                        line-height: ${style.lineHeight || "1.2"};
                        padding: ${style.padding || "0px"};
                        margin: ${style.margin || "0px 0px 16px 0px"};
                        background-color: ${style.backgroundColor || "transparent"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "none"};
                        border-radius: ${style.borderRadius || "0px"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                    " ${customStyle}>${element.content}</h2>`;
                case "Paragraph":
                    return `<p class="${style.className}" style="
                        font-size: ${style.fontSize || "16px"};
                        color: ${style.color || "#333333"};
                        font-family: ${style.fontFamily || "Inter, sans-serif"};
                        font-weight: ${style.fontWeight || "normal"};
                        text-align: ${style.textAlign || "left"};
                        line-height: ${style.lineHeight || "1.6"};
                        padding: ${style.padding || "0px"};
                        margin: ${style.margin || "0px 0px 16px 0px"};
                        background-color: ${style.backgroundColor || "transparent"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "none"};
                        border-radius: ${style.borderRadius || "0px"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                    " ${customStyle}>${element.content}</p>`;
                case "Card":
                    const cardContent = element.content.split('\n');
                    return `<div class="card ${style.className}" style="
                        font-size: ${style.fontSize || "16px"};
                        color: ${style.color || "#000000"};
                        font-family: ${style.fontFamily || "Inter, sans-serif"};
                        font-weight: ${style.fontWeight || "normal"};
                        text-align: ${style.textAlign || "left"};
                        line-height: ${style.lineHeight || "1.5"};
                        padding: ${style.padding || "20px"};
                        margin: ${style.margin || "0px"};
                        background-color: ${style.backgroundColor || "#ffffff"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "1px solid #e5e7eb"};
                        border-radius: ${style.borderRadius || "8px"};
                        box-shadow: ${style.boxShadow || "0 2px 4px rgba(0,0,0,0.1)"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                    " ${customStyle}>
                        <h3>${cardContent[0] || "Card Title"}</h3>
                        <p>${cardContent[1] || "Card content"}</p>
                    </div>`;
                case "Form":
                    const formFields = element.content.split('\n');
                    return `<form class="${style.className}" style="
                        padding: ${style.padding || "20px"};
                        margin: ${style.margin || "0px"};
                        background-color: ${style.backgroundColor || "#f9fafb"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "1px solid #e5e7eb"};
                        border-radius: ${style.borderRadius || "8px"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                        color: ${style.color || "#000000"};
                    " ${customStyle}>
                        ${formFields.map(field => field.trim() ? `
                            <div style="margin-bottom: 15px;">
                                <label>${field}</label>
                                <input type="text" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        ` : '').join('')}
                        <button type="submit" style="
                            padding: 10px 20px;
                            background: #3b82f6;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            font-weight: bold;
                            cursor: pointer;
                        ">Submit</button>
                    </form>`;
                case "Divider":
                    return `<hr class="${style.className}" style="
                        height: ${style.height || "1px"};
                        background-color: ${style.backgroundColor || "#e5e7eb"};
                        margin: ${style.margin || "20px 0"};
                        border: ${style.border || "none"};
                        width: ${style.width || "100%"};
                    " ${customStyle}>`;
                case "Custom HTML":
                    return element.content;
                default:
                    return `<div class="${style.className}" style="
                        font-size: ${style.fontSize || "16px"};
                        color: ${style.color || "#000000"};
                        font-family: ${style.fontFamily || "Inter, sans-serif"};
                        padding: ${style.padding || "0px"};
                        margin: ${style.margin || "0px"};
                        background-color: ${style.backgroundColor || "transparent"};
                        background-image: ${style.backgroundImage || "none"};
                        border: ${style.border || "none"};
                        border-radius: ${style.borderRadius || "0px"};
                        width: ${style.width || "auto"};
                        height: ${style.height || "auto"};
                    " ${customStyle}>${element.content}</div>`;
            }
        }

        // Render the entire application
        function renderApp() {
            const root = document.getElementById('root');
            
            root.innerHTML = `
                <div class="flex h-screen">
                    <!-- Sidebar Toggle for Mobile -->
                    <div class="sidebar-toggle" onclick="toggleSidebar()">
                        <i class="fas fa-bars mr-2"></i> ${isSidebarOpen ? 'Close' : 'Open'} Sidebar
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="sidebar w-80 ${isSidebarOpen ? 'active' : ''}">
                        <h1 class="text-2xl font-bold text-gray-800">Webpage Builder</h1>
                        
                        <!-- Section Selection -->
                        <div class="mb-6">
                            <h3 class="font-semibold text-gray-700 mb-3">Add Section</h3>
                            <div class="flex flex-wrap gap-2 mb-3">
                                ${Object.keys(sectionCategories).map(category => `
                                    <button class="tab-button ${selectedCategory === category ? 'active' : ''}" 
                                        onclick="selectedCategory = '${category}'; renderApp()">
                                        ${category}
                                    </button>
                                `).join('')}
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                ${sectionCategories[selectedCategory].map(type => `
                                    <button class="bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg p-3 text-sm font-medium flex items-center justify-center"
                                        onclick="addSection('${type}')">
                                        <i class="fas fa-plus mr-2"></i> ${type}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Elements Library -->
                        <div class="mb-6">
                            <h3 class="font-semibold text-gray-700 mb-3">Elements</h3>
                            <div class="grid grid-cols-2 gap-2">
                                ${Object.entries(elementTypes).map(([type, data]) => `
                                    <div class="draggable-item bg-gray-100 hover:bg-blue-100 rounded-lg p-3 text-sm font-medium flex items-center justify-center cursor-move"
                                        draggable="true"
                                        ondragstart="handleDragStart(event, '${type}')">
                                        <i class="fas ${data.icon} mr-2"></i> ${type}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Section Properties -->
                        ${selectedSection ? `
                            <div class="mb-6">
                                <h3 class="font-semibold text-gray-700 mb-3">Section Properties</h3>
                                
                                <div class="flex gap-2 mb-3">
                                    <button class="tab-button ${activeTab === 'content' ? 'active' : ''}" 
                                        onclick="activeTab = 'content'; renderApp()">
                                        Content
                                    </button>
                                    <button class="tab-button ${activeTab === 'style' ? 'active' : ''}" 
                                        onclick="activeTab = 'style'; renderApp()">
                                        Style
                                    </button>
                                </div>
                                
                                ${activeTab === 'content' ? `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Columns</label>
                                        <div class="flex items-center gap-2">
                                            <button class="bg-red-500 hover:bg-red-600 text-white rounded-lg px-3 py-2 text-sm font-medium"
                                                onclick="removeColumn(${selectedSection.id}, ${selectedSection.columns - 1})" 
                                                ${selectedSection.columns <= 1 ? 'disabled' : ''}>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="text-sm font-medium">${selectedSection.columns}</span>
                                            <button class="bg-green-500 hover:bg-green-600 text-white rounded-lg px-3 py-2 text-sm font-medium"
                                                onclick="addColumn(${selectedSection.id})">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    ${selectedSection.columns > 0 ? `
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Column Widths</label>
                                            ${selectedSection.widths.map((width, index) => `
                                                <div class="width-control mb-2">
                                                    <span class="text-xs text-gray-600">Column ${index + 1}</span>
                                                    <input type="range" min="10" max="90" value="${width}" 
                                                        class="width-slider"
                                                        oninput="updateColumnWidth(${selectedSection.id}, ${index}, parseFloat(this.value))">
                                                    <input type="number" min="10" max="90" value="${width}" 
                                                        class="width-input"
                                                        oninput="updateColumnWidth(${selectedSection.id}, ${index}, parseFloat(this.value))">
                                                    <span class="text-xs text-gray-600">%</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    <button class="bg-red-500 hover:bg-red-600 text-white rounded-lg w-full py-2 text-sm font-medium mb-4"
                                        onclick="removeSection(${selectedSection.id})">
                                        <i class="fas fa-trash mr-2"></i> Remove Section
                                    </button>
                                ` : `
                                    <div class="style-control-group">
                                        <h4>Background</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Background Color</label>
                                            <div class="color-picker-container">
                                                <input type="color" value="${selectedSection.styles.backgroundColor === 'transparent' ? '#ffffff' : (selectedSection.styles.backgroundColor || '#ffffff')}" 
                                                    onchange="updateSectionStyle(${selectedSection.id}, 'backgroundColor', this.value)">
                                                <input type="text" value="${selectedSection.styles.backgroundColor || 'transparent'}" 
                                                    onchange="updateSectionStyle(${selectedSection.id}, 'backgroundColor', this.value)">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="style-control-group">
                                        <h4>Spacing</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Padding</label>
                                            <input type="text" value="${selectedSection.styles.padding || '16px'}" 
                                                onchange="updateSectionStyle(${selectedSection.id}, 'padding', this.value)">
                                        </div>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Gap</label>
                                            <input type="text" value="${selectedSection.styles.gap || '16px'}" 
                                                onchange="updateSectionStyle(${selectedSection.id}, 'gap', this.value)">
                                        </div>
                                    </div>

                                    <div class="style-control-group">
                                        <h4>Class Name</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">CSS Class</label>
                                            <input type="text" value="${selectedSection.styles.className || ''}" 
                                                onchange="updateSectionStyle(${selectedSection.id}, 'className', this.value)">
                                        </div>
                                    </div>
                                `}
                            </div>
                        ` : ''}
                        
                        <!-- Element Properties -->
                        ${selectedElement ? `
                            <div class="mb-6">
                                <h3 class="font-semibold text-gray-700 mb-3">Element Properties</h3>
                                
                                <div class="flex gap-2 mb-3">
                                    <button class="tab-button ${activeTab === 'content' ? 'active' : ''}" 
                                        onclick="activeTab = 'content'; renderApp()">
                                        Content
                                    </button>
                                    <button class="tab-button ${activeTab === 'style' ? 'active' : ''}" 
                                        onclick="activeTab = 'style'; renderApp()">
                                        Style
                                    </button>
                                    <button class="tab-button ${activeTab === 'advanced' ? 'active' : ''}" 
                                        onclick="activeTab = 'advanced'; renderApp()">
                                        Advanced
                                    </button>
                                </div>
                                
                                ${activeTab === 'content' ? `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                                        ${selectedElement.type === 'Custom HTML' ? `
                                            <textarea 
                                                onchange="updateElementContent(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)"
                                                rows="6">${selectedElement.content}</textarea>
                                        ` : `
                                            <textarea 
                                                onchange="updateElementContent(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)"
                                                rows="4">${selectedElement.content}</textarea>
                                        `}
                                    </div>
                                    
                                    ${selectedElement.type === 'Image' ? `
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Image Alignment</label>
                                            <div class="alignment-buttons">
                                                <div class="alignment-btn ${selectedElement.styles.margin === '0px 0px 0px auto' ? 'active' : ''}" 
                                                    onclick="setImageAlignment('right')">
                                                    <i class="fas fa-align-right"></i>
                                                    <span class="text-xs">Right</span>
                                                </div>
                                                <div class="alignment-btn ${selectedElement.styles.margin === '0px auto' ? 'active' : ''}" 
                                                    onclick="setImageAlignment('center')">
                                                    <i class="fas fa-align-center"></i>
                                                    <span class="text-xs">Center</span>
                                                </div>
                                                <div class="alignment-btn ${!selectedElement.styles.margin || selectedElement.styles.margin === '0px' ? 'active' : ''}" 
                                                    onclick="setImageAlignment('left')">
                                                    <i class="fas fa-align-left"></i>
                                                    <span class="text-xs">Left</span>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    ${['Text', 'Heading', 'Paragraph'].includes(selectedElement.type) ? `
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Text Alignment</label>
                                            <div class="alignment-buttons">
                                                <div class="alignment-btn ${selectedElement.styles.textAlign === 'right' ? 'active' : ''}" 
                                                    onclick="setTextAlignment('right')">
                                                    <i class="fas fa-align-right"></i>
                                                    <span class="text-xs">Right</span>
                                                </div>
                                                <div class="alignment-btn ${selectedElement.styles.textAlign === 'center' ? 'active' : ''}" 
                                                    onclick="setTextAlignment('center')">
                                                    <i class="fas fa-align-center"></i>
                                                    <span class="text-xs">Center</span>
                                                </div>
                                                <div class="alignment-btn ${selectedElement.styles.textAlign === 'left' || !selectedElement.styles.textAlign ? 'active' : ''}" 
                                                    onclick="setTextAlignment('left')">
                                                    <i class="fas fa-align-left"></i>
                                                    <span class="text-xs">Left</span>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <button class="bg-red-500 hover:bg-red-600 text-white rounded-lg w-full py-2 text-sm font-medium"
                                        onclick="removeElement(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id})">
                                        <i class="fas fa-trash mr-2"></i> Remove Element
                                    </button>
                                ` : activeTab === 'style' ? `
                                    <div class="style-control-group">
                                        <h4>Typography</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Font Family</label>
                                            <select onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'fontFamily', this.value)">
                                                ${fontOptions.map(font => `
                                                    <option value="${font}" ${selectedElement.styles.fontFamily === font ? 'selected' : ''}>
                                                        ${font.split(',')[0]}
                                                    </option>
                                                `).join('')}
                                            </select>
                                        </div>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Font Size</label>
                                            <div class="input-with-unit">
                                                <input type="text" value="${selectedElement.styles.fontSize || '16px'}" 
                                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'fontSize', this.value)">
                                                <span class="unit">px</span>
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Line Height</label>
                                            <input type="text" value="${selectedElement.styles.lineHeight || '1.5'}" 
                                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'lineHeight', this.value)">
                                        </div>
                                    </div>
                                    
                                    <div class="style-control-group">
                                        <h4>Colors</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Text Color</label>
                                            <div class="color-picker-container">
                                                <input type="color" value="${selectedElement.styles.color || '#000000'}" 
                                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'color', this.value)">
                                                <input type="text" value="${selectedElement.styles.color || '#000000'}" 
                                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'color', this.value)">
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Background Color</label>
                                            <div class="color-picker-container">
                                                <input type="color" value="${selectedElement.styles.backgroundColor === 'transparent' ? '#ffffff' : (selectedElement.styles.backgroundColor || '#ffffff')}" 
                                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'backgroundColor', this.value)">
                                                <input type="text" value="${selectedElement.styles.backgroundColor || 'transparent'}" 
                                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'backgroundColor', this.value)">
                                            </div>
                                        </div>
                                        ${selectedElement.type !== 'Image' ? `
                                            <div class="mb-2">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Background Gradient</label>
                                                <div class="alignment-buttons">
                                                    <div class="alignment-btn ${selectedElement.styles.backgroundImage && selectedElement.styles.backgroundImage.includes('linear-gradient') ? 'active' : ''}" 
                                                        onclick="setBackgroundGradient('linear')">
                                                        <i class="fas fa-sliders-h"></i>
                                                        <span class="text-xs">Linear</span>
                                                    </div>
                                                    <div class="alignment-btn ${selectedElement.styles.backgroundImage && selectedElement.styles.backgroundImage.includes('radial-gradient') ? 'active' : ''}" 
                                                        onclick="setBackgroundGradient('radial')">
                                                        <i class="fas fa-circle"></i>
                                                        <span class="text-xs">Radial</span>
                                                    </div>
                                                    <div class="alignment-btn ${!selectedElement.styles.backgroundImage || selectedElement.styles.backgroundImage === 'none' ? 'active' : ''}" 
                                                        onclick="setBackgroundGradient('none')">
                                                        <i class="fas fa-times"></i>
                                                        <span class="text-xs">None</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <div class="style-control-group">
                                        <h4>Spacing</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Padding</label>
                                            <input type="text" value="${selectedElement.styles.padding || '0px'}" 
                                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'padding', this.value)">
                                        </div>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Margin</label>
                                            <input type="text" value="${selectedElement.styles.margin || '0px'}" 
                                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'margin', this.value)">
                                        </div>
                                    </div>
                                    
                                    <div class="style-control-group">
                                        <h4>Borders</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Border</label>
                                            <input type="text" value="${selectedElement.styles.border || 'none'}" 
                                                onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'border', this.value)"
                                                placeholder="e.g., 1px solid #000">
                                        </div>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Border Radius</label>
                                            <div class="input-with-unit">
                                                <input type="text" value="${selectedElement.styles.borderRadius || '0px'}" 
                                                    onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'borderRadius', this.value)">
                                                <span class="unit">px</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    ${selectedElement.type === 'Image' ? `
                                        <div class="style-control-group">
                                            <h4>Image Properties</h4>
                                            <div class="mb-2">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Width</label>
                                                <div class="input-with-unit">
                                                    <input type="text" value="${selectedElement.styles.width || '100%'}" 
                                                        onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'width', this.value)">
                                                    <span class="unit">px/%</span>
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Max Width</label>
                                                <div class="input-with-unit">
                                                    <input type="text" value="${selectedElement.styles.maxWidth || '300px'}" 
                                                        onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'maxWidth', this.value)">
                                                    <span class="unit">px</span>
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Object Fit</label>
                                                <select onchange="updateElementStyle(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, 'objectFit', this.value)">
                                                    <option value="contain" ${selectedElement.styles.objectFit === 'contain' ? 'selected' : ''}>Contain</option>
                                                    <option value="cover" ${selectedElement.styles.objectFit === 'cover' ? 'selected' : ''}>Cover</option>
                                                    <option value="fill" ${selectedElement.styles.objectFit === 'fill' ? 'selected' : ''}>Fill</option>
                                                    <option value="scale-down" ${selectedElement.styles.objectFit === 'scale-down' ? 'selected' : ''}>Scale Down</option>
                                                    <option value="none" ${selectedElement.styles.objectFit === 'none' ? 'selected' : ''}>None</option>
                                                </select>
                                            </div>
                                        </div>
                                    ` : ''}
                                ` : `
                                    <div class="style-control-group">
                                        <h4>Custom CSS</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">CSS Code</label>
                                            <textarea class="custom-css-editor" 
                                                onchange="updateElementCustomCSS(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)"
                                                placeholder="Enter custom CSS code">${selectedElement.customCSS || ''}</textarea>
                                        </div>
                                    </div>
                                    
                                    <div class="style-control-group">
                                        <h4>Class Name</h4>
                                        <div class="mb-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">CSS Class</label>
                                            <input type="text" value="${selectedElement.className || ''}" 
                                                onchange="updateElementClassName(${selectedSection.id}, ${selectedColumn}, ${selectedElement.id}, this.value)">
                                        </div>
                                    </div>
                                `}
                            </div>
                        ` : ''}
                        
                        <!-- Export/Import Buttons -->
                        <div class="mt-6">
                            <button class="bg-green-500 hover:bg-green-600 text-white rounded-lg w-full py-2 text-sm font-medium mb-2"
                                onclick="exportHTML()">
                                <i class="fas fa-download mr-2"></i> Export HTML
                            </button>
                            <button class="bg-purple-500 hover:bg-purple-600 text-white rounded-lg w-full py-2 text-sm font-medium"
                                onclick="showImportModal = true; renderApp()">
                                <i class="fas fa-upload mr-2"></i> Import HTML
                            </button>
                        </div>
                    </div>
                    
                    <!-- Preview Area -->
                    <div class="preview-area flex-1 overflow-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Preview</h2>
                            <div class="flex gap-2">
                                <button class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="previewInNewTab()">
                                    <i class="fas fa-eye mr-2"></i> Preview
                                </button>
                                <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="isMobileView = !isMobileView; renderApp()">
                                    <i class="fas ${isMobileView ? 'fa-desktop' : 'fa-mobile-alt'} mr-2"></i> ${isMobileView ? 'Desktop' : 'Mobile'} View
                                </button>
                            </div>
                        </div>
                        
                        <div class="${isMobileView ? 'mobile-preview' : ''}">
                            ${sections.length === 0 ? `
                                <div class="bg-white rounded-lg shadow p-8 text-center">
                                    <i class="fas fa-plus-circle text-4xl text-gray-300 mb-4"></i>
                                    <h3 class="text-lg font-medium text-gray-700 mb-2">No Sections Added</h3>
                                    <p class="text-gray-500 mb-4">Add a section from the sidebar to get started</p>
                                    <button class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-medium"
                                        onclick="addSection('1 Column')">
                                        <i class="fas fa-plus mr-2"></i> Add First Section
                                    </button>
                                </div>
                            ` : ''}
                            
                            ${sections.map(section => `
                                <div class="preview-container ${selectedSection && selectedSection.id === section.id ? 'selected-section' : ''}" 
                                    onclick="selectedSection = ${JSON.stringify(section).replace(/"/g, '&quot;')}; selectedElement = null; renderApp()">
                                    
                                    <div class="section-header flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-medium text-gray-800">${section.type}</h3>
                                        <button class="text-red-500 hover:text-red-700"
                                            onclick="event.stopPropagation(); removeSection(${section.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="section-preview" style="
                                        display: ${section.styles.display || 'flex'};
                                        flex-direction: ${section.styles.flexDirection || 'row'};
                                        gap: ${section.styles.gap || '16px'};
                                        background-color: ${section.styles.backgroundColor || 'transparent'};
                                        padding: ${section.styles.padding || '16px'};
                                        color: ${section.styles.color || '#000000'};
                                    ">
                                        ${section.elements.map((column, colIndex) => `
                                            <div class="column" style="width: ${section.widths[colIndex]}%; position: relative;"
                                                onclick="event.stopPropagation(); selectedColumn = ${colIndex}; selectedElement = null; renderApp()">
                                                
                                                <div class="column-resize-handle" 
                                                    onclick="event.stopPropagation()"></div>
                                                
                                                <div class="column-content drop-zone"
                                                    ondragover="handleDragOver(event)"
                                                    ondragleave="handleDragLeave(event)"
                                                    ondrop="handleDrop(event, ${section.id}, ${colIndex})"
                                                    onclick="event.stopPropagation()">
                                                    
                                                    ${column.length === 0 ? `
                                                        <div class="text-center text-gray-400 py-8">
                                                            <i class="fas fa-arrow-down text-2xl mb-2"></i>
                                                            <p>Drag elements here or click to add</p>
                                                        </div>
                                                    ` : ''}
                                                    
                                                    ${column.map(element => `
                                                        <div class="element ${selectedElement && selectedElement.id === element.id ? 'selected-element' : ''}"
                                                            onclick="event.stopPropagation(); selectedElement = ${JSON.stringify(element).replace(/"/g, '&quot;')}; selectedColumn = ${colIndex}; renderApp()">
                                                            ${renderElement(element)}
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <!-- Export Modal -->
                ${showExportModal ? `
                    <div class="modal">
                        <div class="modal-content">
                            <h3 class="text-lg font-medium text-gray-800 mb-4">Export HTML</h3>
                            <textarea rows="10" class="w-full mb-4" readonly>${htmlExport}</textarea>
                            <div class="flex gap-2 justify-end">
                                <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="showExportModal = false; renderApp()">
                                    Cancel
                                </button>
                                <button class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="copyHTML()">
                                    Copy to Clipboard
                                </button>
                                <button class="bg-green-500 hover:bg-green-600 text-white rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="downloadHTML()">
                                    Download HTML
                                </button>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                <!-- Import Modal -->
                ${showImportModal ? `
                    <div class="modal">
                        <div class="modal-content">
                            <h3 class="text-lg font-medium text-gray-800 mb-4">Import HTML</h3>
                            <p class="text-gray-600 mb-4">Paste your HTML code below to import</p>
                            <textarea rows="10" class="w-full mb-4" oninput="importHtml = this.value"></textarea>
                            <div class="flex gap-2 justify-end">
                                <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="showImportModal = false; importHtml = ''; renderApp()">
                                    Cancel
                                </button>
                                <button class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-4 py-2 text-sm font-medium"
                                    onclick="importHTML()">
                                    Import
                                </button>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            isSidebarOpen = !isSidebarOpen;
            renderApp();
        }

        // Initialize the app
        function initApp() {
            // Add a default section to start with
            addSection('1 Column');
        }

        // Start the app when the page loads
        window.onload = initApp;
    </script>
</body>
</html>
